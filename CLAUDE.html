<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CLAUDE.md • connector</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" sizes="any" href="favicon.ico"><link rel="manifest" href="site.webmanifest"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="CLAUDE.md"><meta property="og:image" content="https://novonordisk-opensource.github.io/connector/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">connector</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9003</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="articles/connector.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/Consistent-API.html">Understanding Connector Package Methods</a></li>
    <li><a class="dropdown-item" href="articles/customize.html">How to extend connector</a></li>
    <li><a class="dropdown-item" href="articles/without-yaml.html">Using connector without YAML files</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NovoNordisk-OpenSource/connector/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>CLAUDE.md</h1>
      <small class="dont-index">Source: <a href="https://github.com/NovoNordisk-OpenSource/connector/blob/main/CLAUDE.md" class="external-link"><code>CLAUDE.md</code></a></small>
    </div>

<div id="claudemd" class="section level1">

<p>This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.</p>
<div class="section level2">
<h2 id="project-overview">Project Overview<a class="anchor" aria-label="anchor" href="#project-overview"></a></h2>
<p>The <code>connector</code> package is an R package that provides a unified interface for accessing different data sources in clinical research. It abstracts file systems, databases, and cloud storage behind a consistent API, allowing users to switch between backends without changing their R code.</p>
</div>
<div class="section level2">
<h2 id="development-commands">Development Commands<a class="anchor" aria-label="anchor" href="#development-commands"></a></h2>
<div class="section level3">
<h3 id="package-development">Package Development<a class="anchor" aria-label="anchor" href="#package-development"></a></h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load package for development</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">load_all</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run all tests</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">test</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run specific test file</span></span>
<span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_file.html" class="external-link">test_file</a></span><span class="op">(</span><span class="st">'tests/testthat/test-fs.R'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check package (comprehensive check including examples and vignettes)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install dependencies</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_deps</span><span class="op">(</span>dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate documentation</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">document</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build package</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">build</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build and install locally</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="code-quality">Code Quality<a class="anchor" aria-label="anchor" href="#code-quality"></a></h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Style check and auto-format</span></span>
<span><span class="fu">styler</span><span class="fu">::</span><span class="fu">style_pkg</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Lint package for code quality issues</span></span>
<span><span class="fu">lintr</span><span class="fu">::</span><span class="fu">lint_package</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check test coverage</span></span>
<span><span class="fu">covr</span><span class="fu">::</span><span class="fu"><a href="http://covr.r-lib.org/reference/report.html" class="external-link">report</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Spell check</span></span>
<span><span class="fu">spelling</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/spelling//reference/spell_check_package.html" class="external-link">spell_check_package</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="vignette-and-documentation">Vignette and Documentation<a class="anchor" aria-label="anchor" href="#vignette-and-documentation"></a></h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build vignettes</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">build_vignettes</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build pkgdown site locally</span></span>
<span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgdown.r-lib.org/reference/build_site.html" class="external-link">build_site</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="core-architecture">Core Architecture<a class="anchor" aria-label="anchor" href="#core-architecture"></a></h2>
<div class="section level3">
<h3 id="design-pattern-r6--s3-hybrid">Design Pattern: R6 + S3 Hybrid<a class="anchor" aria-label="anchor" href="#design-pattern-r6--s3-hybrid"></a></h3>
<p>The package uses a hybrid R6/S3 approach: - <strong>R6 classes</strong> (<code>Connector</code>, <code>ConnectorFS</code>, <code>ConnectorDBI</code>) manage state and provide object-oriented structure - <strong>S3 generics</strong> (<code><a href="reference/read_cnt.html">read_cnt()</a></code>, <code><a href="reference/write_cnt.html">write_cnt()</a></code>, <code><a href="reference/list_content_cnt.html">list_content_cnt()</a></code>) provide familiar R method dispatch - <strong>S3 methods</strong> in <code>*_methods.R</code> files bridge the gap between generics and R6 implementations</p>
</div>
<div class="section level3">
<h3 id="key-components">Key Components<a class="anchor" aria-label="anchor" href="#key-components"></a></h3>
<div class="section level4">
<h4 id="configuration-system-connectr">Configuration System (<code>connect.R</code>)<a class="anchor" aria-label="anchor" href="#configuration-system-connectr"></a></h4>
<ul><li>
<code><a href="reference/connect.html">connect()</a></code> function parses YAML configuration files</li>
<li>Supports template interpolation with <code>{metadata.key}</code> syntax</li>
<li>Validates configuration structure and creates appropriate backend objects</li>
<li>Returns <code>connectors</code> object containing named backend instances</li>
</ul></div>
<div class="section level4">
<h4 id="generic-system-cnt_genericsr">Generic System (<code>cnt_generics.R</code>)<a class="anchor" aria-label="anchor" href="#generic-system-cnt_genericsr"></a></h4>
<p>Defines the complete API surface: - Core operations: <code><a href="reference/read_cnt.html">read_cnt()</a></code>, <code><a href="reference/write_cnt.html">write_cnt()</a></code>, <code><a href="reference/list_content_cnt.html">list_content_cnt()</a></code>, <code><a href="reference/remove_cnt.html">remove_cnt()</a></code> - File operations: <code><a href="reference/upload_cnt.html">upload_cnt()</a></code>, <code><a href="reference/download_cnt.html">download_cnt()</a></code> - Directory operations: <code><a href="reference/create_directory_cnt.html">create_directory_cnt()</a></code>, <code><a href="reference/remove_directory_cnt.html">remove_directory_cnt()</a></code> - Database operations: <code><a href="reference/tbl_cnt.html">tbl_cnt()</a></code>, <code><a href="reference/disconnect_cnt.html">disconnect_cnt()</a></code></p>
</div>
<div class="section level4">
<h4 id="backend-resolution-generic_backendr">Backend Resolution (<code>generic_backend.R</code>)<a class="anchor" aria-label="anchor" href="#backend-resolution-generic_backendr"></a></h4>
<ul><li>
<code>create_backend()</code> instantiates backends from configuration</li>
<li>
<code>get_backend_fct()</code> resolves backend type strings to constructor functions</li>
<li>Supports both built-in backends (<code>connector_fs</code>, <code>connector_dbi</code>) and external packages (<code>package::function</code>)</li>
</ul></div>
<div class="section level4">
<h4 id="file-system-backend-fsr-fs_r">File System Backend (<code>fs.R</code>, <code>fs_*.R</code>)<a class="anchor" aria-label="anchor" href="#file-system-backend-fsr-fs_r"></a></h4>
<ul><li>
<code>ConnectorFS</code> R6 class for file operations</li>
<li>Format detection based on file extensions</li>
<li>Conditional dependencies for different file formats (arrow, haven, readxl)</li>
<li>Separate files for reading (<code>fs_read.R</code>), writing (<code>fs_write.R</code>), and methods (<code>fs_methods.R</code>)</li>
</ul></div>
<div class="section level4">
<h4 id="database-backend-dbir-dbi_r">Database Backend (<code>dbi.R</code>, <code>dbi_*.R</code>)<a class="anchor" aria-label="anchor" href="#database-backend-dbir-dbi_r"></a></h4>
<ul><li>
<code>ConnectorDBI</code> R6 class for database operations</li>
<li>Uses DBI interface for database-agnostic operations</li>
<li>Automatic connection cleanup via <code>finalize()</code> method</li>
<li>Lazy evaluation support through <code><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">dplyr::tbl()</a></code>
</li>
</ul></div>
</div>
<div class="section level3">
<h3 id="configuration-file-structure">Configuration File Structure<a class="anchor" aria-label="anchor" href="#configuration-file-structure"></a></h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span><span class="co">               # Optional: Template variables</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="at">  </span><span class="fu">key</span><span class="kw">:</span><span class="at"> value</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="fu">env</span><span class="kw">:</span><span class="co">                    # Optional: Environment variables to set</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="at">  </span><span class="fu">key</span><span class="kw">:</span><span class="at"> value</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="fu">datasources</span><span class="kw">:</span><span class="co">            # Required: Backend definitions</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"unique_name"</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="at">    </span><span class="fu">backend</span><span class="kw">:</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="at">      </span><span class="fu">type</span><span class="kw">:</span><span class="at"> </span><span class="st">"connector_fs"</span><span class="co">  # or "connector_dbi" or "package::function"</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">      # backend-specific parameters</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testing-architecture">Testing Architecture<a class="anchor" aria-label="anchor" href="#testing-architecture"></a></h3>
<ul><li>Uses <code>testthat</code> (edition 3) for testing framework</li>
<li>Test files organized by component (<code>test-fs.R</code>, <code>test-dbi.R</code>, <code>test-connect.R</code>)</li>
<li>Uses <code><a href="https://withr.r-lib.org/reference/with_tempfile.html" class="external-link">withr::local_tempdir()</a></code> for isolated file system tests</li>
<li>Uses <code><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">RSQLite::SQLite()</a></code> with <code>:memory:</code> for database tests</li>
<li>Snapshot testing for configuration validation and error messages</li>
</ul></div>
<div class="section level3">
<h3 id="extension-pattern">Extension Pattern<a class="anchor" aria-label="anchor" href="#extension-pattern"></a></h3>
<p>New backends should: 1. Inherit from <code>Connector</code> R6 class 2. Implement required methods in the class 3. Create constructor function following <code>connector_*</code> naming convention 4. Add S3 method implementations in separate <code>*_methods.R</code> file 5. Follow existing testing patterns</p>
</div>
<div class="section level3">
<h3 id="key-dependencies">Key Dependencies<a class="anchor" aria-label="anchor" href="#key-dependencies"></a></h3>
<ul><li>
<strong>Core</strong>: R6, checkmate, cli, purrr, glue, yaml</li>
<li>
<strong>File I/O</strong>: fs, readr, arrow, haven, readxl, writexl, vroom</li>
<li>
<strong>Database</strong>: DBI, dplyr, dbplyr</li>
<li>
<strong>Logging</strong>: zephyr (required), whirl (optional)</li>
<li>
<strong>Development</strong>: testthat (edition 3), withr, devtools</li>
</ul></div>
<div class="section level3">
<h3 id="error-handling">Error Handling<a class="anchor" aria-label="anchor" href="#error-handling"></a></h3>
<ul><li>Uses <code><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli::cli_abort()</a></code> for structured error messages</li>
<li>Comprehensive parameter validation with <code>checkmate</code>
</li>
<li>Graceful handling of optional dependencies with <code><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace()</a></code>
</li>
<li>Helpful error messages for configuration issues</li>
</ul><p>This architecture enables a consistent user experience across different data sources while maintaining extensibility for new backends and file formats.</p>
</div>
</div>
<div class="section level2">
<h2 id="development-workflow">Development Workflow<a class="anchor" aria-label="anchor" href="#development-workflow"></a></h2>
<div class="section level3">
<h3 id="cicd-pipeline">CI/CD Pipeline<a class="anchor" aria-label="anchor" href="#cicd-pipeline"></a></h3>
<p>The package uses GitHub Actions for continuous integration: - <strong>check_current_version</strong>: Validates package version compliance - <strong>pkgdown</strong>: Builds and deploys documentation site - <strong>coverage</strong>: Generates test coverage reports via codecov - <strong>megalinter</strong>: Runs comprehensive linting across multiple languages</p>
</div>
<div class="section level3">
<h3 id="package-structure">Package Structure<a class="anchor" aria-label="anchor" href="#package-structure"></a></h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode txt"><code class="sourceCode default"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>R/                          # Core package code</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>├── connect.R              # Main entry point - connect() function</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>├── cnt_generics.R         # S3 generic definitions</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>├── connector.R            # Base R6 Connector class</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>├── fs*.R                  # File system backend implementation</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>├── dbi*.R                 # Database backend implementation</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>└── *_methods.R            # S3 method implementations</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>tests/testthat/            # Test suite</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>├── test-*.R              # Component tests</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>├── configs/              # Test configuration files</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>└── scripts/              # Test helper scripts</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>inst/</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>├── config/               # Example configuration files</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>└── examples/             # Usage examples</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>dev/                      # Development utilities (not included in package)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="configuration-examples">Configuration Examples<a class="anchor" aria-label="anchor" href="#configuration-examples"></a></h3>
<p>The <code>inst/config/</code> directory contains reference configuration files: - <code>_connector.yml</code>: Basic file system and database setup - <code>default_config.yml</code>: Template with common patterns - <code>example_for_generic.yml</code>: Generic backend demonstration</p>
</div>
<div class="section level3">
<h3 id="naming-conventions">Naming Conventions<a class="anchor" aria-label="anchor" href="#naming-conventions"></a></h3>
<ul><li>
<strong>R6 classes</strong>: PascalCase (e.g., <code>ConnectorFS</code>, <code>ConnectorDBI</code>)</li>
<li>
<strong>S3 generics</strong>: snake_case with <code>_cnt</code> suffix (e.g., <code><a href="reference/read_cnt.html">read_cnt()</a></code>, <code><a href="reference/write_cnt.html">write_cnt()</a></code>)</li>
<li>
<strong>Constructor functions</strong>: <code>connector_*</code> prefix (e.g., <code><a href="reference/connector_fs.html">connector_fs()</a></code>, <code><a href="reference/connector_dbi.html">connector_dbi()</a></code>)</li>
<li>
<strong>Method files</strong>: <code>*_methods.R</code> pattern for S3 implementations</li>
<li>
<strong>Backend files</strong>: Component-based grouping (<code>fs_read.R</code>, <code>fs_write.R</code>, <code>dbi_*.R</code>)</li>
</ul></div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cervan Girard, Aksel Thomsen, Vladimir Obucina.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

